start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[[1]]
start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1]
end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1]
?download.file
x
x[, start_index:end_index]
x[start_index:end_index,]
start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] - 1
end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
x[start_index:end_index,]
start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1]
end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
x[start_index:end_index,]
start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
x[start_index:end_index,]
x[start_index:end_index, 1]
x[start_index:end_index, 1:2]
colnames(x) <- c("group", "total")
x
x <- x[start_index:end_index, 1:2]
colnames(x) <- c("group", "total")
x
url_template <- 'https://www2.census.gov/programs-surveys/demo/tables/families/{YEAR}/cps-{YEAR}/tabc3-all.xls'
data_list <- list()
for (year in seq(2000, 2021, by=1)) {
url <- gsub("\\{YEAR\\}", year, url_template)
localPath = paste0(year, ".xls")
download.file(url=url, destfile = localPath)
x <- read_excel("test.xls", trim_ws=T,  skip=5, col_names = F)
start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
x <- x[start_index:end_index, 1:2]
colnames(x) <- c("group", "total")
x <- mutate(x, year=year)
data_list[length(data_list) + 1] <- x
}
df <- bind_rows(data_list)
View(df)
View(data_list)
data_list[1]
data_list[[1]]
View(data_list)
for (year in seq(2000, 2021, by=1)) {
url <- gsub("\\{YEAR\\}", year, url_template)
localPath = paste0(year, ".xls")
download.file(url=url, destfile = localPath)
x <- read_excel("test.xls", trim_ws=T,  skip=5, col_names = F)
start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
x <- x[start_index:end_index, 1:2]
colnames(x) <- c("group", "total")
x <- mutate(x, year=year)
print(x)
# data_list[length(data_list) + 1] <- x
}
data_list <- list()
data_list[length(data_list) + 1] <- x
View(data_list)
data_list <- list()
url_template <- 'https://www2.census.gov/programs-surveys/demo/tables/families/{YEAR}/cps-{YEAR}/tabc3-all.xls'
data_list <- list()
for (year in seq(2007, 2021, by=1)) {
url <- gsub("\\{YEAR\\}", year, url_template)
localPath = paste0(year, ".xls")
download.file(url=url, destfile = localPath)
x <- read_excel("test.xls", trim_ws=T,  skip=5, col_names = F)
start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
x <- x[start_index:end_index, 1:2]
colnames(x) <- c("group", "total")
x <- mutate(x, year=year)
print(x)
data_list[[length(data_list) + 1]] <- x
}
data_list <- list()
for (year in seq(2007, 2021, by=1)) {
url <- gsub("\\{YEAR\\}", year, url_template)
localPath = paste0(year, ".xls")
download.file(url=url, destfile = localPath)
x <- read_excel(localPath, trim_ws=T,  skip=5, col_names = F)
start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
x <- x[start_index:end_index, 1:2]
colnames(x) <- c("group", "total")
x <- mutate(x, year=year)
print(x)
data_list[[length(data_list) + 1]] <- x
}
for (year in seq(2007, 2021, by=1)) {
url <- gsub("\\{YEAR\\}", year, url_template)
localPath = paste0(year, ".xls")
download.file(url=url, destfile = localPath)
x <- read_excel(localPath, trim_ws=T,  skip=5, col_names = F)
print(x)
# start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
# end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
# x <- x[start_index:end_index, 1:2]
# colnames(x) <- c("group", "total")
# x <- mutate(x, year=year)
# print(x)
# data_list[[length(data_list) + 1]] <- x
}
for (year in seq(2007, 2021, by=1)) {
localPath = paste0("data/", year, ".xls")
x <- read_excel(localPath, trim_ws=T,  skip=5, col_names = F)
print(x)
# start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
# end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
# x <- x[start_index:end_index, 1:2]
# colnames(x) <- c("group", "total")
# x <- mutate(x, year=year)
# print(x)
# data_list[[length(data_list) + 1]] <- x
}
for (year in seq(2007, 2021, by=1)) {
localPath = paste0("data/", year, ".xls")
x <- read_excel(localPath, trim_ws=T,  skip=5, col_names = F)
start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
x <- x[start_index:end_index, 1:2]
colnames(x) <- c("group", "total")
x <- mutate(x, year=year)
print(x)
# data_list[[length(data_list) + 1]] <- x
}
for (year in seq(2007, 2021, by=1)) {
localPath = paste0("data/", year, ".xls")
x <- read_excel(localPath, trim_ws=T,  skip=5, col_names = F)
start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
# x <- x[start_index:end_index, 1:2]
# colnames(x) <- c("group", "total")
# x <- mutate(x, year=year)
print(start_index)
# data_list[[length(data_list) + 1]] <- x
}
for (year in seq(2007, 2021, by=1)) {
localPath = paste0("data/", year, ".xls")
x <- read_excel(localPath, trim_ws=T,  skip=5, col_names = F)
start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
# x <- x[start_index:end_index, 1:2]
# colnames(x) <- c("group", "total")
# x <- mutate(x, year=year)
print(start_index, end_index)
# data_list[[length(data_list) + 1]] <- x
}
for (year in seq(2007, 2021, by=1)) {
localPath = paste0("data/", year, ".xls")
x <- read_excel(localPath, trim_ws=T,  skip=5, col_names = F)
start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
# x <- x[start_index:end_index, 1:2]
# colnames(x) <- c("group", "total")
# x <- mutate(x, year=year)
print(start_index)
print(end_index)
# data_list[[length(data_list) + 1]] <- x
}
for (year in seq(2007, 2021, by=1)) {
localPath = paste0("data/", year, ".xls")
x <- read_excel(localPath, trim_ws=T,  skip=5, col_names = F)
start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
x <- x[start_index:end_index, 1:2]
# colnames(x) <- c("group", "total")
# x <- mutate(x, year=year)
print(x)
# data_list[[length(data_list) + 1]] <- x
}
for (year in seq(2007, 2021, by=1)) {
localPath = paste0("data/", year, ".xls")
x <- read_excel(localPath, trim_ws=T,  skip=5, col_names = F)
start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
# x <- x[start_index:end_index, 1:2]
# colnames(x) <- c("group", "total")
# x <- mutate(x, year=year)
print(x)
# data_list[[length(data_list) + 1]] <- x
}
for (year in seq(2007, 2021, by=1)) {
localPath = paste0("data/", year, ".xls")
x <- read_excel(localPath, trim_ws=T,  skip=5, col_names = F)
# start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
# end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
# x <- x[start_index:end_index, 1:2]
colnames(x) <- c("group", "total")
# x <- mutate(x, year=year)
print(x)
# data_list[[length(data_list) + 1]] <- x
}
for (year in seq(2007, 2021, by=1)) {
localPath = paste0("data/", year, ".xls")
x <- read_excel(localPath, trim_ws=T,  skip=5, col_names = F)
# start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
# end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
# x <- x[start_index:end_index, 1:2]
colnames(x) <- c("group", "total")
x <- x %>%
select("group", "total")
# x <- mutate(x, year=year)
print(x)
# data_list[[length(data_list) + 1]] <- x
}
for (year in seq(2007, 2021, by=1)) {
localPath = paste0("data/", year, ".xls")
x <- read_excel(localPath, trim_ws=T,  skip=5, col_names = F)
# start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
# end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
# x <- x[start_index:end_index, 1:2]
colnames(x) <- c("group", "total")
x <- x %>%
select("group", "total") %>%
slice(1,5)
# x <- mutate(x, year=year)
print(x)
# data_list[[length(data_list) + 1]] <- x
}
for (year in seq(2007, 2021, by=1)) {
localPath = paste0("data/", year, ".xls")
x <- read_excel(localPath, trim_ws=T,  skip=5, col_names = F)
# start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
# end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
# x <- x[start_index:end_index, 1:2]
colnames(x) <- c("group", "total")
x <- x %>%
select("group", "total") %>%
slice(1:5)
# x <- mutate(x, year=year)
print(x)
# data_list[[length(data_list) + 1]] <- x
}
for (year in seq(2007, 2021, by=1)) {
localPath = paste0("data/", year, ".xls")
x <- read_excel(localPath, trim_ws=T,  skip=5, col_names = F)
# start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
# end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
# x <- x[start_index:end_index, 1:2]
colnames(x) <- c("group", "total")
x <- x %>%
select("group", "total") %>%
slice(start_index:end_index)
# x <- mutate(x, year=year)
print(x)
# data_list[[length(data_list) + 1]] <- x
}
for (year in seq(2007, 2021, by=1)) {
localPath = paste0("data/", year, ".xls")
x <- read_excel(localPath, trim_ws=T,  skip=5, col_names = F)
# start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
# end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
# x <- x[start_index:end_index, 1:2]
colnames(x) <- c("group", "total")
x <- x %>%
select("group", "total") %>%
slice(start_index:end_index) %>%
mutate(year)
# x <- mutate(x, year=year)
print(x)
# data_list[[length(data_list) + 1]] <- x
}
data_list <- list()
for (year in seq(2007, 2021, by=1)) {
localPath = paste0("data/", year, ".xls")
x <- read_excel(localPath, trim_ws=T,  skip=5, col_names = F)
# start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
# end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
# x <- x[start_index:end_index, 1:2]
colnames(x) <- c("group", "total")
x <- x %>%
select("group", "total") %>%
slice(start_index:end_index) %>%
mutate(year)
print(x)
data_list[[length(data_list) + 1]] <- x
}
df <- bind_rows(data_list)
View(data_list)
for (year in seq(2007, 2021, by=1)) {
localPath = paste0("data/", year, ".xls")
x <- read_excel(localPath, trim_ws=T,  skip=5, col_names = F)
# start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
# end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
# x <- x[start_index:end_index, 1:2]
colnames(x) <- c("group", "total")
x <- x %>%
select("group", "total") %>%
slice(start_index:end_index) %>%
mutate(year, total=as.integer(total))
print(x)
data_list[[length(data_list) + 1]] <- x
}
df <- bind_rows(data_list)
data_list <- list()
for (year in seq(2007, 2021, by=1)) {
localPath = paste0("data/", year, ".xls")
x <- read_excel(localPath, trim_ws=T,  skip=5, col_names = F)
# start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
# end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
# x <- x[start_index:end_index, 1:2]
colnames(x) <- c("group", "total")
x <- x %>%
select("group", "total") %>%
slice(start_index:end_index) %>%
mutate(year, total=as.integer(total))
print(x)
data_list[[length(data_list) + 1]] <- x
}
df <- bind_rows(data_list)
View(df)
data_list <- list()
for (year in seq(2007, 2021, by=1)) {
localPath = paste0("data/", year, ".xls")
x <- read_excel(localPath, trim_ws=T,  skip=5, col_names = F)
start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
end_index <- which(grepl("PRESENCE OF PARENT'S UNMARRIED PARTNER", x$...1))[1] -1
# x <- x[start_index:end_index, 1:2]
colnames(x) <- c("group", "total")
x <- x %>%
select("group", "total") %>%
slice(start_index:end_index) %>%
mutate(year, total=as.integer(total))
print(x)
data_list[[length(data_list) + 1]] <- x
}
data_list <- list()
for (year in seq(2007, 2021, by=1)) {
localPath = paste0("data/", year, ".xls")
x <- read_excel(localPath, trim_ws=T,  skip=5, col_names = F)
start_index <- which(grepl("PRESENCE OF SIBLINGS", x$...1))[1] + 1
end_index <- which(grepl("Five or more siblings", x$...1))[1]
# x <- x[start_index:end_index, 1:2]
colnames(x) <- c("group", "total")
x <- x %>%
select("group", "total") %>%
slice(start_index:end_index) %>%
mutate(year, total=as.integer(total))
print(x)
data_list[[length(data_list) + 1]] <- x
}
df <- bind_rows(data_list)
View(df)
df %>%
ggplot(
x = year,
y = total,
color = group
) +
geom_line()
df %>%
ggplot(
aes(
x = year,
y = total,
color = group
)
) +
geom_line()
dw_retrieve_chart_metadata('X72T4')
dw_retrieve_chart_metadata('X72T4')
dw_retrieve_chart_metadata('X72T4')
dw_retrieve_chart_metadata('X72T4')$content$metadata$visualize$labels
dw_retrieve_chart_metadata('rOJL0')$content$metadata$visualize$labels
dw_basemaps() %>%  View()
library(DatawRappr)
dw_basemaps() %>%  View()
dw_basemaps %>%  View()
x <- dw_retrieve_chart_metadata('rOJL0')
x$content$metadata$visualize$basemap
x$content$metadata$visualize$basemap
x$content$metadata$visualize$basemap
x$content$metadata$visualize$basemap
basemap <- x$content$metadata$visualize$basemap
grepl("counties", basemap)
basemap_slug <- if grepl("counties", basemap) 'counties-'
basemap_slug <- if(grepl("counties", basemap), 'counties-')
basemap_slug <- if (grepl("counties", basemap)) 'counties-' else NA
grepl("counties", basemap)
grepl(c("counties", "state"), basemap)
levels <- c("counties",
"municipalities",
"zip-code-postal-code",
"census-tracts-2020",
"school-districts",
"congressional-districts",
"state-legislative-districts-upper",
"state-legislative-districts-lower-2020")
sapply(levels, grepl(., basemap))
sapply(levels, grepl(basemap))
sapply(levels, grepl, basemap)
sapply(levels, grep, basemap)
sapply(levels, grepl, basemap)
?sapply
apply(levels, grepl, basemap)
lapply(levels, grepl, basemap)
which(lapply(levels, grepl, basemap))
which(lapply(levels, grepl, basemap), arr.ind = FALSE, useNames = TRUE)
which(sapply(levels, grepl, basemap), arr.ind = FALSE, useNames = TRUE)
which(lapply(levels, grepl, basemap))
which(sapply(levels, grepl, basemap))
which(x <- sapply(levels, grepl, basemap))
z
x
z <- which(sapply(levels, grepl, basemap))
z
z[1]
z[[1]]
levels[z]
z <- which(sapply(levels, grepl, basemap))
levels[z]
levels[which(sapply(levels, grepl, basemap))]
x <- dw_retrieve_chart_metadata('rOJL0')
basemap <- usa-pennsylvania-census-tracts-2020
levels <- c("counties",
"municipalities",
"zip-code-postal-code",
"census-tracts-2020",
"school-districts",
"congressional-districts",
"state-legislative-districts-upper",
"state-legislative-districts-lower-2020")
levels[which(sapply(levels, grepl, basemap))]
basemap <- 'usa-pennsylvania-census-tracts-2020'
levels <- c("counties",
"municipalities",
"zip-code-postal-code",
"census-tracts-2020",
"school-districts",
"congressional-districts",
"state-legislative-districts-upper",
"state-legislative-districts-lower-2020")
levels[which(sapply(levels, grepl, basemap))]
basemap <- 'usa-pennsylvania-state-legislative-districts-lower-2020'
levels <- c("counties",
"municipalities",
"zip-code-postal-code",
"census-tracts-2020",
"school-districts",
"congressional-districts",
"state-legislative-districts-upper",
"state-legislative-districts-lower-2020")
levels[which(sapply(levels, grepl, basemap))]
dw_data_from_chart("VigLh") %>%
write_clip()
base_chart_id <- 'rOJL0'
base_meta <- dw_retrieve_chart_metadata(base_chart_id)
series_id <- "Charlotte"
basemap_geography_id <- "north-carolina"
base_meta <- dw_retrieve_chart_metadata(base_chart_id)
levels <- c("counties",
"municipalities",
"zip-code-postal-code",
"census-tracts-2020",
"school-districts",
"congressional-districts",
"state-legislative-districts-upper",
"state-legislative-districts-lower-2020")
basemap_level_id <- levels[which(sapply(levels, grepl, base_meta$content$metadata$visualize$basemap))]
basemap_level_id
basemap_id
basemap_id <- paste0(basemap_geography_id, '-', basemap_level_id)
message(paste0("Using ", basemap_id))
basemap_id
basemap_id <- "north-carolina-counties"
dw_edit_chart(
"Zootc",
visualize = list(
basemap = basemap_id
)
)
x <- dw_retrieve_chart_metadata('rOJL0')
basemap <- x$content$metadata$visualize$basemap
basemap
base_meta <- dw_retrieve_chart_metadata('rOJL0')
basemap_geography_id = locals[i,]$basemap_geography_id
setwd("~/Documents/GitHub/tools/batch-datawrapper-generator/scripts")
locals <- read_csv("../data/locals-2.csv")
base_meta <- dw_retrieve_chart_metadata('rOJL0')
basemap_geography_id = locals[i,]$basemap_geography_id
i <- 1
basemap_geography_id = locals[i,]$basemap_geography_id
locals
locals <- read_csv("../data/locals-2.csv")
base_meta <- dw_retrieve_chart_metadata('rOJL0')
basemap_geography_id = locals[i,]$basemap_geography_id
basemap_level_id <- levels[which(sapply(levels, grepl, base_meta$content$metadata$visualize$basemap))]
basemap_id <- paste0("usa-", basemap_geography_id, '-', basemap_level_id)
message(paste0("Using ", basemap_id))
basemap_id <- paste0(basemap_geography_id, '-', basemap_level_id)
message(paste0("Using ", basemap_id))
i <1
i <- 2
basemap_geography_id = locals[i,]$basemap_geography_id
basemap_level_id <- levels[which(sapply(levels, grepl, base_meta$content$metadata$visualize$basemap))]
basemap_id <- paste0(basemap_geography_id, '-', basemap_level_id)
message(paste0("Using ", basemap_id))
dw_edit_chart(
"Zootc",
visualize = list(
basemap = basemap_id
)
)
cwd
cwd()
getwd()
x <- dw_retrieve_chart_metadata('16f9i')
basemap <- x$content$metadata$visualize$basemap
dw_basemaps %>% View()
basemap_level_id <- levels[which(sapply(levels, grepl, base_meta$content$metadata$visualize$basemap))]
Sys.getenv("DW_KEY")
